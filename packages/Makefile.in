### @configure_input@


EMACS= ../src/emacs


## This should be coming from autoconf!
ELPA=/home/phillord/src/git/elpa-git/master
ifdef ELPA
ELPA_ENV=ELPA=$(ELPA)
endif


DIRS=$(filter-out .,$(subst ./,,$(shell find . -maxdepth 1 -type d)))

## dependent on makefile
all: pkg-all makefile-inc.mk

check: cleanlog check-packages ert-summarize

check-maybe: check-packages

WRITE_LOG = > $@ 2>&1 || { stat=ERROR; cat $@; }; echo $$stat: $@

makefile-inc.mk: ./admin/package-makefile.el
	$(ELPA_ENV) $(EMACS) --batch --load admin/package-makefile.el \
		--funcall package-makefile

include makefile-inc.mk

cleanlog:
	find . -name "*log" -exec rm -v {} \;

clean: cleanlog
	find . -name "*pkg.el" -exec rm -v {} \;
	find . -name "*-autoloads.el" -exec rm -v {} \;
	find . -name "*elc" -exec rm -v {} \;


.PHONY: check clean all
